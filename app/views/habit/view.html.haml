%h2= @habit.what
%span#description Click on the current day to mark it off. You may not mark off previous days (cheater).
#habit-view
  %table#calendar
    %tr
      %th= "Sunday"
      %th= "Monday"
      %th= "Tuesday"
      %th= "Wednesday"
      %th= "Thursday"
      %th= "Friday"
      %th= "Saturday"
    - day = @habit.start_date - @habit.start_date.wday
    - last_day = day + 21
    - weeks = 0
    - max_weeks = @habit.start_date.wday == 0 ? 3 : 4
    - until weeks == max_weeks
      %tr 
        - begin
          %td{:class => day == Date.today ? "today" : day < Date.today ? "past" : "" }
            .container
              - if day >= @habit.start_date && day < @habit.start_date + 21
                %span= "Day %s" % (day + 1 - @habit.start_date).to_s
              - else
                %span &nbsp;
              %span= day.strftime "%m/%d"
              - if @habit.finished_dates.include?(day)
                %span.x X
          - day = day + 1
        - end until day.wday == 0
      - weeks = weeks + 1
  .content-block
    - if @current_user.phone_number
      %span#sms-enable You have enabled SMS integration!
    - else
      %span#sms-enable Text #{ ENV['TWILIO_PHONE_NUMBER'] } this code: <b>#{ @current_user.sms_code }</b> to enable SMS integration.
  #total
    %span#days-completed= @habit.finished_dates.count
    %span /
    %span#days-total 21
  %a=link_to "Start a new habit", :controller => "habit", :action => "cancel"
